<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Voting Results by County</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <link rel="stylesheet" href="css/style.css" media="screen" />
  </head>
  <body>
    <div id="wrapper">
      <div id="map"></div>
      <input id="slider" type="range" min="1912" max="2012" value="1912" step="4" />
      <span id="range">1912</span>

      <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
      <script src="http://d3js.org/d3.geo.projection.v0.min.js"></script>
      <script src="//d3js.org/queue.v1.min.js"></script>
      <script src="//d3js.org/topojson.v1.min.js"></script>
      <script src="/js/html5slider.js"></script>
      <script>

      var width, height, projection, path, graticule, svg, attributeArray = [], currentAttribute = 0, playing = false;

      $('#slider').on('input', function(){
        $('#range')[0].innerHTML = $(this)[0].value;
        updateMap($(this)[0].value);
      })


      function init() {
        setMap();
        //animateMap();
        //setAvatars();
      }

      function setMap() {

        width = 960, height = 600;
        projection = d3.geo.albersUsa()
            .scale(1000)
            .translate([width / 2, height / 2]);
        path = d3.geo.path()
            .projection(projection);
        svg = d3.select("#map").append("svg")
            .attr("width", width)
            .attr("height", height);

        loadData();
      }

      function setAvatars() {

      }

      function loadData() {
        queue()
            .defer(d3.json, "us.json")
            .defer(d3.csv, "datasofar24.csv")
            .await(processData);
      }
      function processData(error, us, countyData) {
        var counties = us.objects.counties.geometries;
        for (var i in counties) {
          counties[i].properties = {"id": counties[i].id};
          for (var j in countyData) {
            if (counties[i].properties.id == countyData[j].id) {
              for(var k in countyData[i]) {
                if(k != 'name' && k != "id") {
                  if(attributeArray.indexOf(k) == -1 ) {
                    attributeArray.push(k);
                  }
                  counties[i].properties[k] = countyData[j][k];
                }
              }
              break;
            }
          }
        }
        d3.select('#clock').html(attributeArray[currentAttribute]);
        drawMap(us);
      }
      function drawMap(us) {
        svg.selectAll(".county")
        .data(topojson.feature(us, us.objects.counties).features)
        .enter().append("path")
        .attr("class", "county")
        .attr("id", function(d){
          return "code_" + d.properties.id; }, true)
        .attr("d", path);


        d3.selectAll(".county")
        .attr('fill', function(d){
          return '#' + d.properties[attributeArray[currentAttribute]];
        });
      }

      function updateMap(year){
         d3.selectAll('.county').transition()
          .duration(1000)
          .attr('fill', function(d){
            console.log(d);
            return '#' + d.properties[year];
          });
      }

      function sequenceMap() {
        d3.selectAll('.county').transition()
          .duration(1000)
          .attr('fill', function(d){
            return '#' + d.properties[attributeArray[currentAttribute]];
          });

      }

      function setPics() {

        console.log(currentAttribute)

          pic1path = "pics/" + attributeArray[currentAttribute] + "/D.jpg"
          pic2path = "pics/" + attributeArray[currentAttribute] + "/R.jpg"
          pic3path = "pics/" + attributeArray[currentAttribute] + "/O.jpg"

              d3.select('#pic1').attr("src",pic1path);
              // d3.select('#label1').html('Woodrow Wilson');
              d3.select('#pic2').attr("src",pic2path);
              // d3.select('#label2').html('William Howard Taft');
              d3.select('#pic3').attr("src",pic3path);
      }

      function animateMap(){
        var timer;
        d3.select('#play')
        .on('click', function(){
          if(playing == false) {
            timer = setInterval(function(){
              if(currentAttribute < attributeArray.length - 1) {
                currentAttribute += 1;
              } else {
                currentAttribute = 0;
              }



              d3.select('#clock').html(attributeArray[currentAttribute]);
              setPics();
              sequenceMap();
            }, 2000);

            // d3.select('#pic1').attr("src","http://upload.wikimedia.org/wikipedia/commons/b/b0/NewTux.svg");
            d3.select(this).html('stop');
            playing = true;
          } else {
            clearInterval(timer);
            d3.select(this).html('play');
            playing = false;
          }
        });
      }
      window.onload = init();
      </script>
  </body>
</html>